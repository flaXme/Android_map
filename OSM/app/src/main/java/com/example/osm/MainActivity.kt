package com.example.osm


import android.os.Bundle
import android.preference.PreferenceManager
import android.view.View
import android.widget.Button
import android.widget.ProgressBar
import android.widget.TextView
import android.widget.Toast
import androidx.appcompat.app.AppCompatActivity
import okhttp3.*
import okio.IOException
import org.osmdroid.config.Configuration
import org.osmdroid.tileprovider.tilesource.TileSourcePolicy
import org.osmdroid.tileprovider.tilesource.XYTileSource
import org.osmdroid.util.GeoPoint
import org.osmdroid.views.MapView
import org.osmdroid.views.overlay.Marker
import org.osmdroid.views.overlay.Polyline
import java.util.concurrent.TimeUnit


class MainActivity : AppCompatActivity() {
    private lateinit var map : MapView;
    @Volatile
    var subgraphDataDownloaded = false

    var subgraphTilesDownloaded = false
    lateinit var  subGraph: Graph
    private lateinit var downloadBar: ProgressBar
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState);
        //data structure, which contains all nodes and edges information of a subgraph





        //handle permissions first, before map is created. not depicted here

        //load/initialize the osmdroid configuration, this can be done
        // This won't work unless you have imported this: org.osmdroid.config.Configuration.*
        Configuration.getInstance().load(this, PreferenceManager.getDefaultSharedPreferences(this));
        //setting this before the layout is inflated is a good idea
        //it 'should' ensure that the map has a writable location for the map cache, even without permissions
        //if no tiles are displayed, you can try overriding the cache path using Configuration.getInstance().setCachePath
        //see also StorageUtils
        //note, the load method also sets the HTTP User Agent to your application's package name, if you abuse osm's
        //tile servers will get you banned based on this string.


        //inflate and create the map
        setContentView(R.layout.activity_main);
        map = findViewById(R.id.map)
        map.setTileSource(
            XYTileSource(
                "worldMap",
                0, 20, 256, ".png", arrayOf(
                    "https://tiles.fmi.uni-stuttgart.de/"
                ), "Â© OpenStreetMap contributors",
                TileSourcePolicy(
                    2,
                    TileSourcePolicy.FLAG_NO_BULK
                            or TileSourcePolicy.FLAG_NO_PREVENTIVE
                            or TileSourcePolicy.FLAG_USER_AGENT_MEANINGFUL
                            or TileSourcePolicy.FLAG_USER_AGENT_NORMALIZED
                )
            ))
            downloadBar = findViewById(R.id.downloadProgressBar)
            val downloadStatusText: TextView = findViewById(R.id.downloadStatus)
            downloadStatusText.text = "Download needed!"

        //add marker on click:






        val mapController = map.controller
        mapController.setZoom(19.0)
        val csBuilding = GeoPoint(48.74518,9.10665)
        val startPoint = GeoPoint(53.518480100000005,10.0154417)
        mapController.setCenter(startPoint)

        //test Markers:
        val markerOnCsBuilding = Marker(map)
        markerOnCsBuilding.position = csBuilding
        markerOnCsBuilding.title = "This is Computer Science building of university Stuttgart."
        markerOnCsBuilding.setAnchor(Marker.ANCHOR_CENTER, Marker.ANCHOR_CENTER)
        map.overlays.add(markerOnCsBuilding)

        //choose subgraph area to download
        var bottomLeft = GeoPoint(53.50, 10.00)
        var bottomRight = GeoPoint(53.50, 10.03)
        var topRight = GeoPoint(53.52, 10.03)
        var topLeft = GeoPoint(53.52, 10.00)
        val area = Polyline(map)
        area.addPoint(bottomLeft)
        area.addPoint(bottomRight)
        area.addPoint(topRight)
        area.addPoint(topLeft)
        area.addPoint(bottomLeft)
        map.overlays.add(area)
        map.invalidate()





        //download button:
        val sendDownloadRequestButton: Button = findViewById(R.id.button0)
        sendDownloadRequestButton.setOnClickListener {
            if (sendDownloadRequestButton.text.equals("download map")){
                downloadBar.visibility = View.VISIBLE
                downloadStatusText.text = "Downloading.."
                Toast.makeText(this,"Start downloading graph data", Toast.LENGTH_LONG).show()
                var minLat = Double.MAX_VALUE
                var maxLat = Double.MIN_VALUE
                var minLong = Double.MAX_VALUE
                var maxLong = Double.MIN_VALUE

                for (p in area.actualPoints){
                    if (p.latitude < minLat){
                        minLat = p.latitude
                    }
                    if (p.latitude > maxLat){
                        maxLat = p.latitude
                    }
                    if (p.longitude < minLong){
                        minLong = p.longitude
                    }
                    if (p.longitude > maxLong){
                        maxLong = p.longitude
                    }
                }
                sendSubgraphGetRequest(minLat, maxLat, minLong, maxLong)
                while(!subgraphDataDownloaded){}
                downloadBar.visibility = View.INVISIBLE
                sendDownloadRequestButton.text = "compute path"

            }else if (sendDownloadRequestButton.text.equals("compute path")){
                downloadBar.visibility = View.VISIBLE
                //compute path as a instance of String and display as instance of Polyline
                val start = 1000
                val end = 1100
                var djikstra = Dijkstra(subGraph, start, end)
                val path = djikstra.shortestPathInLonLat
                println(path)
                //val path = "[[10.0154417, 53.518480100000005], [10.015147, 53.518427800000005], [10.0149068, 53.51837930000001], [10.0146996, 53.518326], [10.014571700000001, 53.518271600000006], [10.0144619, 53.51821940000001], [10.014380500000001, 53.5181589], [10.0143068, 53.518096500000006], [10.0142545, 53.5180176], [10.0142232, 53.5179277], [10.0142333, 53.5178419], [10.0142722, 53.51775000000001], [10.0143413, 53.517678000000004], [10.014431400000001, 53.517616100000005], [10.014554, 53.517563700000004], [10.014710000000001, 53.517518800000005], [10.0148696, 53.5174801], [10.0150539, 53.5174584], [10.0157375, 53.517513300000005], [10.01666, 53.517568100000005], [10.017244600000001, 53.517586900000005], [10.0172769, 53.517587600000006], [10.017477000000001, 53.5175939], [10.0187185, 53.51761260000001], [10.0196445, 53.5176025], [10.020012600000001, 53.517592900000004], [10.0208144, 53.517569200000004], [10.021217400000001, 53.517548000000005], [10.0216188, 53.5175167], [10.022150100000001, 53.517462300000005], [10.022675900000001, 53.517392], [10.0237061, 53.517220900000005], [10.0245166, 53.517102900000005], [10.0248787, 53.5170588], [10.025144800000001, 53.51704], [10.025420200000001, 53.517039700000005], [10.025706600000001, 53.517062300000006], [10.0261026, 53.517138], [10.026504000000001, 53.5172821], [10.0266411, 53.5173617], [10.026833400000001, 53.51748550000001], [10.026943600000001, 53.5175884], [10.0271586, 53.51787], [10.027234100000001, 53.518011400000006], [10.0272711, 53.5181429], [10.027286700000001, 53.51831000000001], [10.027270300000001, 53.518420600000006], [10.027232900000001, 53.5185274], [10.0271556, 53.5186755], [10.0269746, 53.5189207], [10.0269007, 53.5191445], [10.026282700000001, 53.519804], [10.0262086, 53.5198887], [10.025942200000001, 53.5201955], [10.0257082, 53.5204645], [10.0235167, 53.523015300000004], [10.0231755, 53.5234262], [10.022998900000001, 53.523661000000004], [10.0228307, 53.523891500000005], [10.022626500000001, 53.5242184], [10.022569500000001, 53.5243097], [10.0222657, 53.52493440000001], [10.0221187, 53.5255385], [10.0220397, 53.5259949], [10.022059800000001, 53.526362000000006], [10.022137, 53.5267196], [10.0222928, 53.527222800000004], [10.0224648, 53.527633200000004], [10.022664, 53.528004800000005], [10.022920300000001, 53.5284392], [10.0230564, 53.528652900000004], [10.0233705, 53.52912980000001], [10.023598600000001, 53.5294851], [10.0238273, 53.529749900000006], [10.0240892, 53.5300008], [10.0243187, 53.53022300000001], [10.0244012, 53.530308700000006], [10.0247384, 53.530659], [10.025159500000001, 53.5310999], [10.025701900000001, 53.531709400000004], [10.0270927, 53.5332182], [10.0274064, 53.5335587], [10.027749400000001, 53.5339321], [10.0278627, 53.534059500000005], [10.028460500000001, 53.5347275], [10.028954200000001, 53.53526780000001], [10.029347900000001, 53.5357368], [10.029668200000001, 53.5361794], [10.0300624, 53.536790200000006], [10.0305265, 53.5376673], [10.030552700000001, 53.537715600000006], [10.0308974, 53.5383532], [10.031047200000001, 53.538612400000005], [10.031272300000001, 53.538961], [10.0315926, 53.539446000000005], [10.0317346, 53.5396494], [10.0318994, 53.5398908], [10.0319622, 53.5399789], [10.03194, 53.540075400000006], [10.031902200000001, 53.5401679], [10.031851600000001, 53.5402506], [10.0318188, 53.5402804], [10.0314893, 53.5405323], [10.0313055, 53.540635800000004], [10.030870700000001, 53.540829300000006], [10.0303717, 53.541040800000005], [10.0295448, 53.541391700000005], [10.0290379, 53.541608200000006], [10.028594100000001, 53.541782700000006], [10.0283098, 53.5418723], [10.0281073, 53.541930900000004], [10.0277413, 53.5420365], [10.027254600000001, 53.542154200000006], [10.0266151, 53.542288500000005], [10.025383000000001, 53.5425454], [10.0249307, 53.542631500000006], [10.0246624, 53.5426969], [10.023506300000001, 53.5429607], [10.023115200000001, 53.543046200000006], [10.022573300000001, 53.5431588], [10.022337, 53.5432196], [10.0221614, 53.5432749], [10.021942600000001, 53.543357], [10.021692400000001, 53.5434521], [10.0209145, 53.54374120000001], [10.0202024, 53.5440041], [10.0171883, 53.5450698], [10.016827800000002, 53.5451933], [10.016725800000001, 53.545227100000005], [10.0165833, 53.5452871], [10.0163618, 53.545385], [10.016168700000001, 53.54548440000001], [10.0161025, 53.545525700000006], [10.015804800000002, 53.545723100000004], [10.015753400000001, 53.5457691], [10.0156044, 53.545910500000005], [10.0153963, 53.5461302], [10.014875100000001, 53.5467644], [10.014556800000001, 53.5470685], [10.014281200000001, 53.5472398], [10.0139738, 53.5473763], [10.0136499, 53.5474783], [10.0127054, 53.5477222], [10.0124028, 53.547787400000004], [10.0120082, 53.547859900000006], [10.0118591, 53.5478925], [10.0117758, 53.5479034], [10.011671900000001, 53.547904100000004], [10.011356000000001, 53.547887100000004], [10.0110297, 53.547863500000005], [10.0106781, 53.5478351], [10.0099443, 53.547785000000005], [10.009777600000001, 53.547778400000006], [10.008934100000001, 53.547774200000006], [10.008448000000001, 53.54778820000001], [10.0077236, 53.547809300000004], [10.006648400000001, 53.5478244], [10.0064299, 53.54781010000001], [10.006212300000001, 53.547791200000006], [10.005853700000001, 53.547744800000004], [10.0046684, 53.5475737], [10.0030882, 53.5473481], [10.0027723, 53.54734130000001], [10.0023774, 53.547344800000005], [10.0017748, 53.547357100000006], [10.0013146, 53.547361], [10.001058500000001, 53.5473894], [10.0008871, 53.5474356], [10.000794200000001, 53.547459100000005], [10.0006482, 53.5474976], [10.0004671, 53.5475459], [10.000409900000001, 53.5475597], [10.000297900000001, 53.54758150000001], [9.9999556, 53.547611700000004], [9.999677, 53.5476177], [9.9993145, 53.5476139], [9.9990884, 53.547606300000005], [9.9985242, 53.5475739], [9.9978598, 53.5475124], [9.9972467, 53.5474679], [9.997201800000001, 53.547464600000005], [9.996954800000001, 53.547454300000005], [9.9966082, 53.5474314], [9.9965548, 53.5474271], [9.9954725, 53.547339400000006], [9.9949881, 53.5473031], [9.9942103, 53.547269500000006], [9.9933514, 53.547235900000004], [9.993265500000001, 53.5472313], [9.9926055, 53.547198300000005], [9.9925191, 53.5471955], [9.9922865, 53.547188000000006], [9.991849100000001, 53.5471736], [9.9909774, 53.547140600000006], [9.990683200000001, 53.5471367], [9.9903969, 53.547139400000006], [9.990148600000001, 53.547148], [9.989877400000001, 53.547161], [9.989597100000001, 53.54718200000001], [9.989082100000001, 53.547238300000004], [9.9889962, 53.5472497], [9.9888037, 53.547275400000004], [9.9884812, 53.547318600000004], [9.987455800000001, 53.5474777], [9.9865917, 53.547605000000004], [9.9862655, 53.547657400000006], [9.986052, 53.547693800000005], [9.9858068, 53.5477585], [9.9854351, 53.5478759], [9.985290800000001, 53.5479276], [9.9852535, 53.547932100000004], [9.984735200000001, 53.5480443], [9.9846535, 53.5480633], [9.9844357, 53.548115200000005], [9.983860400000001, 53.5482461], [9.9835086, 53.5483254], [9.9832877, 53.5483655], [9.9826098, 53.5485114], [9.982069800000001, 53.5486276], [9.9816275, 53.5487175], [9.9814133, 53.5487611], [9.9810207, 53.548843000000005], [9.980697600000001, 53.548910400000004], [9.9804022, 53.54896960000001], [9.979964200000001, 53.5490575], [9.9792161, 53.549181100000006], [9.978615900000001, 53.549243800000006], [9.978209300000001, 53.549276500000005], [9.978143000000001, 53.549279500000004], [9.977996500000001, 53.5492909], [9.9778429, 53.5492994], [9.9775284, 53.5493109], [9.9774689, 53.5493126], [9.974986900000001, 53.5494209], [9.9746878, 53.549434500000004], [9.9742958, 53.5494691], [9.9736633, 53.5495644], [9.9734668, 53.549602], [9.973281400000001, 53.5496691], [9.9730751, 53.549708200000005], [9.9715378, 53.5500046], [9.971139500000001, 53.55014430000001], [9.9708617, 53.5502703], [9.9701094, 53.5506121], [9.9699361, 53.5506795], [9.9697952, 53.5507415], [9.969637500000001, 53.550808800000006], [9.969336400000001, 53.5509471], [9.969202600000001, 53.5509999], [9.968913800000001, 53.5511363], [9.9686862, 53.55124240000001], [9.9685711, 53.5512955], [9.9684947, 53.551331000000005], [9.9675445, 53.551788800000004], [9.967236600000001, 53.5519575], [9.966864300000001, 53.552264900000004], [9.9666867, 53.5524155], [9.965938600000001, 53.553048700000005], [9.965819300000001, 53.5531506], [9.965754800000001, 53.553208600000005], [9.9654805, 53.553440800000004], [9.965162900000001, 53.55381250000001], [9.965031, 53.5539994], [9.9648651, 53.55425], [9.9648246, 53.55433], [9.9647643, 53.554527300000004], [9.9646758, 53.5548281], [9.9646448, 53.554929900000005], [9.964619500000001, 53.5551146], [9.9645819, 53.5553097], [9.9645389, 53.5555718], [9.9645009, 53.5557358], [9.9643716, 53.5560009], [9.964226, 53.556406300000006], [9.9641126, 53.556614700000004], [9.963998100000001, 53.5568448], [9.9639851, 53.556880500000005], [9.963917400000001, 53.5571829], [9.963800800000001, 53.5577338], [9.9637487, 53.5578878], [9.963592, 53.55800180000001], [9.9634835, 53.558098400000006], [9.9634093, 53.558148700000004], [9.963393100000001, 53.5581595], [9.962912300000001, 53.558440100000006], [9.9626903, 53.5586987], [9.9626312, 53.558726], [9.9625274, 53.5587827], [9.961678500000001, 53.559260900000005], [9.961583500000001, 53.559313], [9.961486500000001, 53.559372], [9.9612298, 53.5595578], [9.9608865, 53.5597099], [9.9606905, 53.5597885], [9.9604731, 53.5598636], [9.959882700000001, 53.56009950000001], [9.9597498, 53.560156500000005], [9.9597078, 53.560170500000005], [9.9593562, 53.5602753], [9.9590324, 53.560388], [9.958440600000001, 53.560574900000006], [9.958129900000001, 53.560641100000005], [9.9580897, 53.5606494], [9.957695000000001, 53.5607308], [9.9563392, 53.5610105], [9.9555834, 53.561162700000004], [9.955271, 53.561224300000006], [9.955017100000001, 53.5612779], [9.9549461, 53.56129060000001], [9.954848700000001, 53.5613134], [9.9546094, 53.5613638], [9.953510000000001, 53.561634000000005], [9.9533462, 53.561671000000004], [9.9531074, 53.5617249], [9.9527195, 53.5617954], [9.952680200000001, 53.5618026], [9.9525097, 53.561824], [9.9509696, 53.5620277], [9.950046, 53.5621378], [9.949219600000001, 53.562223700000004], [9.949153800000001, 53.562233000000006], [9.949002100000001, 53.562259000000005], [9.9487001, 53.562322900000005], [9.948393600000001, 53.562383200000006], [9.9470848, 53.562663], [9.9457456, 53.5629586], [9.9453786, 53.5630083], [9.9451398, 53.5634394], [9.9449166, 53.5639398], [9.9447904, 53.564265400000004], [9.944674200000001, 53.564592100000006], [9.944633300000001, 53.56475270000001], [9.944599100000001, 53.564904600000006], [9.9445841, 53.565193400000005], [9.944598800000001, 53.5653695], [9.944757300000001, 53.5658504], [9.944805500000001, 53.5660363], [9.9447998, 53.566205700000005], [9.944756400000001, 53.566392900000004], [9.944697600000001, 53.566512200000005], [9.9444991, 53.56672390000001], [9.9443895, 53.5668724], [9.9442757, 53.5670325], [9.944163300000001, 53.5671978], [9.944104000000001, 53.567343300000005], [9.944065700000001, 53.567457600000004], [9.9440393, 53.5675764], [9.9440112, 53.567849200000005], [9.944032700000001, 53.568232800000004], [9.9441123, 53.568886600000006], [9.9441299, 53.5690401], [9.944135300000001, 53.5691361], [9.9441755, 53.569576100000006], [9.944175900000001, 53.5695806], [9.9441796, 53.5696462], [9.9440904, 53.570088600000005], [9.944031500000001, 53.570331700000004], [9.9439648, 53.5704792], [9.9438317, 53.570686900000005], [9.943717900000001, 53.5707997], [9.9434792, 53.5709803], [9.9426597, 53.5716918], [9.9425887, 53.5717535], [9.942494700000001, 53.571874400000006], [9.9422133, 53.5720991], [9.9421198, 53.5721775], [9.941744700000001, 53.5725178], [9.9415107, 53.572664700000004], [9.9413087, 53.572811200000004], [9.941129, 53.5729509], [9.9409573, 53.5730931], [9.9408299, 53.5731959], [9.940700000000001, 53.573323300000006], [9.9399519, 53.5742045], [9.9398155, 53.574355600000004], [9.9385998, 53.5756926], [9.938496200000001, 53.5758115], [9.938438000000001, 53.575894500000004], [9.938428100000001, 53.575908600000005], [9.9380039, 53.5763911], [9.937914800000001, 53.576496500000005], [9.9376972, 53.576748900000005], [9.9375344, 53.576946400000004], [9.9374678, 53.5770252], [9.9371744, 53.577372000000004], [9.935818900000001, 53.5789744], [9.9356658, 53.579151100000004], [9.9356474, 53.5791723], [9.935115900000001, 53.5797855], [9.934647700000001, 53.580332600000006], [9.934569100000001, 53.5804525], [9.9344794, 53.580634700000004], [9.9343112, 53.5811184], [9.934155, 53.581648200000004], [9.9339455, 53.5823401], [9.9338736, 53.582513500000005], [9.9337126, 53.5828769], [9.933670300000001, 53.5830447], [9.9336534, 53.5831694], [9.9336179, 53.583389000000004], [9.933581400000001, 53.5835846], [9.933201700000001, 53.584813200000006], [9.933046800000001, 53.5851775], [9.932936100000001, 53.5854263], [9.932616600000001, 53.5860312], [9.9321801, 53.5868692], [9.932040500000001, 53.587145400000004], [9.9319764, 53.58725930000001], [9.9319105, 53.587384400000005], [9.9318282, 53.587540800000006], [9.931814000000001, 53.5875677], [9.931728600000001, 53.5877582], [9.931371, 53.5885527], [9.9311206, 53.5890677], [9.931007800000001, 53.589308100000004], [9.930613800000001, 53.5901353], [9.9303191, 53.59085760000001], [9.9301385, 53.5911418], [9.9300412, 53.5912513], [9.929881700000001, 53.5914287], [9.929762, 53.591551], [9.9293774, 53.591827300000006], [9.929165600000001, 53.59194110000001], [9.929033200000001, 53.592006000000005], [9.9288065, 53.5920867], [9.928623100000001, 53.5921864], [9.9284915, 53.59227550000001], [9.9284089, 53.5923401], [9.9280557, 53.5926039], [9.9276997, 53.592868800000005], [9.926917600000001, 53.593423900000005], [9.9265789, 53.59364660000001], [9.9262858, 53.593813600000004], [9.925781500000001, 53.594098100000004], [9.9247829, 53.594651600000006], [9.92418, 53.595052800000005], [9.9241297, 53.5950848], [9.9240449, 53.595134800000004], [9.9240057, 53.5951615], [9.923598400000001, 53.5954611], [9.9232315, 53.5957385], [9.9230497, 53.5958124], [9.9229676, 53.5958368], [9.922812500000001, 53.5958422], [9.9222999, 53.595687100000006], [9.9222363, 53.59565370000001], [9.9213134, 53.595218900000006], [9.9210458, 53.5950567], [9.9209244, 53.59492650000001], [9.9208323, 53.594809100000006], [9.920848900000001, 53.5946609], [9.9209174, 53.5945138], [9.9210423, 53.594362000000004], [9.9214383, 53.594207600000004], [9.9217493, 53.594204600000005], [9.9219281, 53.594233800000005], [9.9220591, 53.59429050000001], [9.922231100000001, 53.5944506], [9.9224435, 53.5947096], [9.9225741, 53.5948933], [9.9227863, 53.5951967], [9.9229249, 53.5954107], [9.923116700000001, 53.59601910000001], [9.9231865, 53.5965708], [9.9231671, 53.59699740000001], [9.9231426, 53.597297700000006], [9.9230815, 53.5975997], [9.9229535, 53.5982903], [9.9227057, 53.5992146], [9.9225249, 53.5997629], [9.922374600000001, 53.600143300000006], [9.922070900000001, 53.600872200000005], [9.921705300000001, 53.60164210000001], [9.9214558, 53.60216260000001], [9.921157800000001, 53.602667800000006], [9.9205982, 53.6036274], [9.920198300000001, 53.6042384], [9.919354400000001, 53.6054733], [9.918936, 53.6061252], [9.9186276, 53.6067437], [9.918501500000001, 53.607097200000005], [9.9184455, 53.6072537], [9.918356900000001, 53.607463700000004], [9.9178929, 53.6085633], [9.917791900000001, 53.6087878], [9.9176269, 53.60911290000001], [9.9175201, 53.6093606], [9.916838100000001, 53.610611000000006], [9.9164367, 53.6112236], [9.9156239, 53.6122639], [9.9153468, 53.61253730000001], [9.9150393, 53.612810100000004], [9.9147575, 53.6130769], [9.9145442, 53.61331920000001], [9.914325400000001, 53.613510000000005], [9.913801300000001, 53.613992800000005], [9.9123879, 53.615202700000005], [9.9117726, 53.615692100000004], [9.9111486, 53.6161857], [9.9104582, 53.616697900000005], [9.9099783, 53.61703790000001], [9.9096074, 53.6173123], [9.9093736, 53.617472600000006], [9.9087502, 53.61789520000001], [9.907950300000001, 53.618416800000006], [9.9074711, 53.6187254], [9.9072329, 53.6188778], [9.9064846, 53.619336700000005], [9.905770500000001, 53.6197542], [9.9055119, 53.619899200000006], [9.905110500000001, 53.620110800000006], [9.9047841, 53.6202783], [9.904620300000001, 53.620366700000005], [9.903888, 53.620694900000004], [9.9035027, 53.620861500000004], [9.902891400000001, 53.6210989], [9.9017791, 53.6214693], [9.90108, 53.621666700000006], [9.900546700000001, 53.621799], [9.9001295, 53.621894700000006], [9.8991951, 53.6220725], [9.898668200000001, 53.622163400000005], [9.8980674, 53.622254700000006], [9.8956712, 53.6225973], [9.894874300000001, 53.6227188], [9.894345600000001, 53.622806800000006], [9.8934055, 53.622977500000005], [9.8931766, 53.623026200000005], [9.892664700000001, 53.6231304], [9.892018100000001, 53.623271], [9.8911531, 53.6234777], [9.890159200000001, 53.6237359], [9.889468, 53.6239318], [9.888783700000001, 53.6241356], [9.8870395, 53.624690400000006], [9.8867572, 53.6247805], [9.8856584, 53.625127000000006], [9.8843847, 53.6255116], [9.8832337, 53.625837800000006], [9.882169000000001, 53.6261257], [9.8814212, 53.6263196], [9.8806715, 53.626507000000004], [9.8796642, 53.62674680000001], [9.877897800000001, 53.62713170000001], [9.876159000000001, 53.627488500000005], [9.8743619, 53.6278549], [9.8734366, 53.6280469], [9.8720766, 53.6283596], [9.8710944, 53.628612700000005], [9.870755, 53.6287036], [9.870317700000001, 53.6288283], [9.8695559, 53.6290734], [9.868767700000001, 53.6293434], [9.8679032, 53.6296522], [9.867436600000001, 53.629828200000006], [9.8654677, 53.6306019], [9.864267, 53.6310775], [9.8631174, 53.631513500000004], [9.8619565, 53.631934900000005], [9.8606207, 53.6323955], [9.859835400000001, 53.632656700000005], [9.8587881, 53.632992300000005], [9.8576931, 53.633326800000006], [9.8570667, 53.633510400000006], [9.856693400000001, 53.633618500000004], [9.856208500000001, 53.633751700000005], [9.8554615, 53.6339503], [9.8542245, 53.634258300000006], [9.853466800000001, 53.6344609], [9.8528187, 53.6346301], [9.851991100000001, 53.63487000000001], [9.850897900000001, 53.635187200000004], [9.849821, 53.6355438], [9.8488761, 53.6358661], [9.8479443, 53.63619490000001], [9.8472671, 53.636440500000006], [9.845656400000001, 53.6370652], [9.8448616, 53.637375500000005], [9.8437272, 53.637832200000005], [9.8425923, 53.638305700000004], [9.841478500000001, 53.638765400000004], [9.8401324, 53.6393229], [9.839026800000001, 53.639785], [9.8377233, 53.640364100000006], [9.837506900000001, 53.6404659], [9.8370121, 53.640704400000004], [9.836412000000001, 53.6410063], [9.8358574, 53.6413121], [9.8354057, 53.641574000000006], [9.834903, 53.6418861], [9.8343589, 53.642248], [9.833916400000001, 53.642558], [9.8329289, 53.6432907], [9.8317359, 53.644201900000006], [9.831047, 53.6447122], [9.830558100000001, 53.6450575], [9.830199200000001, 53.6453013], [9.829680900000001, 53.645633700000005], [9.829371100000001, 53.645825900000006], [9.8290097, 53.6460409], [9.8286529, 53.6462444], [9.8281468, 53.646521400000005], [9.827584700000001, 53.6468172], [9.827511900000001, 53.646854000000005], [9.8262956, 53.6474793], [9.8257422, 53.6477761], [9.8252729, 53.6480401], [9.8249131, 53.6482479], [9.8248762, 53.648276700000004], [9.824554500000001, 53.6484814], [9.8242895, 53.648656700000004], [9.8239619, 53.6488978], [9.823623900000001, 53.64916710000001], [9.8233156, 53.649436900000005], [9.8229474, 53.649807700000004], [9.8228047, 53.6499578], [9.8226998, 53.650079100000006], [9.8224274, 53.650421300000005], [9.8223173, 53.6505695], [9.8221801, 53.650780000000005], [9.8220224, 53.6510436], [9.821866700000001, 53.651338], [9.8217839, 53.65152440000001], [9.8216999, 53.651736500000005], [9.821592, 53.652062], [9.8214764, 53.652480800000006], [9.821352800000001, 53.653119100000005], [9.8213012, 53.653471800000005], [9.8211244, 53.6546807], [9.8210048, 53.6554981], [9.8208222, 53.656746500000004], [9.820752200000001, 53.6572247], [9.820634, 53.657906000000004], [9.8205139, 53.6584182], [9.8204341, 53.658668500000005], [9.8202692, 53.659135600000006], [9.820120600000001, 53.659473000000006], [9.8199927, 53.659738600000004], [9.8198288, 53.6600455], [9.819711700000001, 53.6602517], [9.8192576, 53.660919400000004], [9.8188537, 53.6614385], [9.8184767, 53.6618524], [9.818115200000001, 53.662221300000006], [9.8175211, 53.662762900000004], [9.8170435, 53.663188000000005], [9.8156006, 53.6643996], [9.814308, 53.6654496], [9.8131275, 53.6663871], [9.812676900000001, 53.666740000000004], [9.8095621, 53.669055300000004], [9.806481900000001, 53.6712818], [9.8038871, 53.673190700000006], [9.801990700000001, 53.67466640000001], [9.8009555, 53.6754881], [9.7993881, 53.676779], [9.7987509, 53.677320400000006], [9.797924700000001, 53.6780224], [9.7975285, 53.6783591], [9.7960896, 53.679640400000004], [9.7950584, 53.6805807], [9.793582800000001, 53.681935100000004], [9.791737900000001, 53.683617600000005], [9.788742000000001, 53.686356800000006], [9.7844908, 53.6902587], [9.783498, 53.691196700000006], [9.7822622, 53.692409600000005], [9.7815673, 53.693119100000004], [9.781049300000001, 53.6936558], [9.7798838, 53.6949109], [9.7790788, 53.695809800000006], [9.7785828, 53.696384800000004], [9.7781318, 53.6969159], [9.7779004, 53.697194], [9.7776514, 53.6974931], [9.777179700000001, 53.6980719], [9.776147400000001, 53.69939290000001], [9.775437400000001, 53.7003264], [9.774688000000001, 53.7012999], [9.7742971, 53.7018021], [9.773874000000001, 53.7023458], [9.7731695, 53.703230100000006], [9.772791400000001, 53.7036857], [9.7719204, 53.7047241], [9.7716505, 53.705029], [9.7705401, 53.7062437], [9.7702519, 53.706550400000005], [9.7696647, 53.7071467], [9.7690015, 53.707792000000005], [9.7686688, 53.70810650000001], [9.768374600000001, 53.7083785], [9.7679214, 53.708783700000005], [9.767154900000001, 53.70944840000001], [9.7668383, 53.7097131], [9.766686, 53.709837400000005], [9.7664066, 53.7100651], [9.7660497, 53.710350600000005], [9.7652532, 53.710966000000006], [9.76474, 53.711339200000005], [9.7643552, 53.7116284], [9.7639948, 53.711885], [9.7636786, 53.7121082], [9.763334500000001, 53.712343800000006], [9.7629435, 53.712604000000006], [9.7612413, 53.713701900000004], [9.7596871, 53.714618800000004], [9.7591637, 53.714922], [9.7583455, 53.715370400000005], [9.757724900000001, 53.71570010000001], [9.7569876, 53.71607160000001], [9.756504000000001, 53.716316600000006], [9.755375, 53.7168646], [9.7545915, 53.7172307], [9.7538806, 53.7175492], [9.7536783, 53.7176399], [9.753512500000001, 53.7177141], [9.7525679, 53.71812490000001], [9.7519009, 53.7184023], [9.751171300000001, 53.718696400000006], [9.7500947, 53.7191224], [9.7486964, 53.719669100000004], [9.7468938, 53.720348300000005], [9.7448051, 53.721108900000004], [9.7422223, 53.722054500000006], [9.7397015, 53.7229997], [9.7380429, 53.7236374], [9.7367571, 53.724164200000004], [9.735829800000001, 53.7245464], [9.7349124, 53.7249392], [9.734135700000001, 53.725287900000005], [9.732709, 53.7259522], [9.731935400000001, 53.7263327], [9.7310408, 53.7267803], [9.730233100000001, 53.7272095], [9.7287864, 53.7280128], [9.727649600000001, 53.728682000000006], [9.7256508, 53.7299463], [9.7244931, 53.7307385], [9.7238465, 53.731200400000006], [9.723279400000001, 53.731615700000006], [9.7225114, 53.7322123], [9.7218066, 53.7327761], [9.721236000000001, 53.733245100000005], [9.7202874, 53.734079300000005], [9.719528700000001, 53.734776800000006], [9.718868200000001, 53.735421800000005], [9.717770100000001, 53.7365678], [9.716738300000001, 53.737702500000005], [9.7164128, 53.738090500000006], [9.7160293, 53.738554], [9.715665900000001, 53.7390253], [9.7150456, 53.739876300000006], [9.714415200000001, 53.740785300000006], [9.714002500000001, 53.741433900000004], [9.713535100000001, 53.742218], [9.7129964, 53.743197300000006], [9.7126391, 53.743898200000004], [9.7124545, 53.744263200000006], [9.7120618, 53.745159300000005], [9.7117965, 53.7457987], [9.711548800000001, 53.7463982], [9.7105899, 53.749059200000005], [9.7100176, 53.750861900000004], [9.7095596, 53.752457400000004], [9.709048800000001, 53.754470700000006], [9.708741100000001, 53.7558999], [9.7083452, 53.7580845], [9.7081858, 53.759098200000004], [9.708063800000001, 53.760114], [9.707948400000001, 53.761112000000004], [9.707854600000001, 53.7621077], [9.7076851, 53.764100600000006], [9.7075317, 53.765900900000005], [9.707465800000001, 53.766792900000006], [9.7071009, 53.770594], [9.706691900000001, 53.7737958], [9.7063725, 53.7755768], [9.705954700000001, 53.7773782], [9.7054054, 53.7791939], [9.704769500000001, 53.7809697], [9.7039069, 53.7828287], [9.7034993, 53.7836098], [9.7029837, 53.7845315], [9.702601900000001, 53.785177000000004], [9.7018605, 53.7863303], [9.7011866, 53.787289], [9.7006601, 53.78800330000001], [9.699826, 53.789059300000005], [9.699169900000001, 53.789837600000006], [9.6983984, 53.7906999], [9.697599100000001, 53.7915568], [9.695975, 53.7931486], [9.6951418, 53.793917500000006], [9.694305, 53.7946606], [9.6924718, 53.7961855], [9.6895808, 53.7983823], [9.6882055, 53.7993527], [9.6876651, 53.799719200000006], [9.6858038, 53.8009798], [9.683431500000001, 53.8024677], [9.6823004, 53.803157600000006], [9.6803202, 53.8043301], [9.6789415, 53.8051231], [9.6773539, 53.8060107], [9.6764522, 53.8065178], [9.6752778, 53.8071515], [9.674724000000001, 53.8074567], [9.6713015, 53.809266300000004], [9.6691693, 53.810376100000006], [9.6667421, 53.811646800000005], [9.6522612, 53.8189818], [9.648533, 53.8208612], [9.646099000000001, 53.8220888], [9.6452551, 53.82251960000001], [9.642409200000001, 53.8239722], [9.6420472, 53.824155600000005], [9.640673600000001, 53.8248437], [9.635808800000001, 53.8272812], [9.6335601, 53.8283805], [9.6313154, 53.829468000000006], [9.62906, 53.830553900000005], [9.627626300000001, 53.8312297], [9.6240658, 53.8328792], [9.622510100000001, 53.833592100000004], [9.6198373, 53.834796600000004], [9.6132732, 53.837630100000005], [9.6066853, 53.84035900000001], [9.605029700000001, 53.8410444], [9.602881, 53.841951], [9.601006700000001, 53.8427396], [9.599416900000001, 53.8434382], [9.5981707, 53.8439884], [9.596914, 53.844572400000004], [9.594902300000001, 53.8455346], [9.594673400000001, 53.845641900000004], [9.592952, 53.846512000000004], [9.5909375, 53.8475806], [9.5890204, 53.8486367], [9.586895100000001, 53.849910400000006], [9.584719900000001, 53.851270400000004], [9.582096100000001, 53.852991300000006], [9.5800604, 53.854444], [9.5780312, 53.8559569], [9.5746862, 53.858640900000005], [9.5721618, 53.8607808], [9.5697662, 53.862857600000005], [9.566730900000001, 53.865624200000006], [9.5631207, 53.868901300000005], [9.5619352, 53.8699773], [9.5611552, 53.870685300000005], [9.5603441, 53.871421500000004], [9.559323800000001, 53.872310600000006], [9.558292100000001, 53.8732021], [9.557039900000001, 53.8742936], [9.5549841, 53.8760011], [9.5541516, 53.876659100000005], [9.551305900000001, 53.8788818], [9.5492641, 53.880349900000006], [9.547212400000001, 53.881713600000005], [9.5432649, 53.8841522], [9.5402036, 53.8857973], [9.5369002, 53.8873997], [9.5336798, 53.888783100000005], [9.532090100000001, 53.8894194], [9.5304774, 53.8900256], [9.530173600000001, 53.8901369], [9.5298382, 53.8902598], [9.526569400000001, 53.891381800000005], [9.523071700000001, 53.8925545], [9.5225535, 53.8927283], [9.5200159, 53.893579100000004], [9.519173700000001, 53.893874000000004], [9.5181006, 53.894264400000004], [9.516907900000001, 53.894749000000004], [9.516001600000001, 53.8951483], [9.5148361, 53.895686100000006], [9.513668500000001, 53.8962615], [9.512548800000001, 53.896813300000005], [9.511304200000001, 53.8974027], [9.510677300000001, 53.8976686], [9.509692000000001, 53.898045], [9.508723700000001, 53.8983957], [9.5078428, 53.89871410000001], [9.506727300000001, 53.89906800000001], [9.504101700000001, 53.8999067], [9.5029454, 53.9002817], [9.501636300000001, 53.9007293], [9.499759300000001, 53.9014078], [9.4989194, 53.901727300000005], [9.498266600000001, 53.9019952], [9.4974877, 53.9023364], [9.496496200000001, 53.902774300000004], [9.496184900000001, 53.9029194], [9.495765200000001, 53.903126300000004], [9.4952301, 53.90338010000001], [9.4940464, 53.9039823], [9.493159200000001, 53.9044821], [9.492675700000001, 53.9047465], [9.4923122, 53.904954800000006], [9.4908187, 53.905851000000006], [9.489560500000001, 53.9066899], [9.488290300000001, 53.907607000000006], [9.486974, 53.908692900000005], [9.486091400000001, 53.9094922], [9.4858882, 53.909696000000004], [9.4848072, 53.9108462], [9.4838156, 53.9120561], [9.482987000000001, 53.9131731], [9.4825426, 53.91384660000001], [9.482074200000001, 53.914574300000005], [9.4817418, 53.915110500000004], [9.4815257, 53.915483300000005], [9.4810262, 53.9163736], [9.4807159, 53.9169787], [9.480441800000001, 53.9176051], [9.4801199, 53.9183778], [9.479884700000001, 53.919071100000004], [9.4796644, 53.919841500000004], [9.479517600000001, 53.9203946], [9.479363000000001, 53.9210785], [9.479246700000001, 53.921719700000004], [9.4791931, 53.9221811], [9.479155800000001, 53.9227069], [9.479167700000001, 53.92350570000001], [9.479254300000001, 53.924308200000006], [9.4794592, 53.925784900000004], [9.4796104, 53.926796700000004], [9.4798331, 53.9282443], [9.4799772, 53.928988100000005], [9.4801959, 53.9298105], [9.4805987, 53.930881600000006], [9.480850400000001, 53.931465700000004], [9.4811417, 53.93206300000001], [9.4814459, 53.932629600000006], [9.481777000000001, 53.933196200000005], [9.4820417, 53.9336026], [9.482284700000001, 53.9339713], [9.482944, 53.9349751], [9.4831894, 53.9353574], [9.4837524, 53.936269700000004], [9.4842329, 53.9370842], [9.4846457, 53.9378426], [9.4847219, 53.9379956], [9.4850943, 53.9387422], [9.4854172, 53.9394476], [9.4858235, 53.9404625], [9.4861798, 53.941507], [9.4864577, 53.9425212], [9.486678000000001, 53.943458400000004], [9.4868527, 53.9443835], [9.4869961, 53.9452579], [9.4871453, 53.9466255], [9.487196200000001, 53.947091500000006], [9.487280700000001, 53.9477563], [9.487408400000001, 53.948485700000006], [9.4876263, 53.9494428], [9.4878025, 53.9501398], [9.4880286, 53.9509046], [9.4883249, 53.9517639], [9.4885246, 53.952314400000006], [9.4888122, 53.953107100000004], [9.4894884, 53.9548834], [9.4900319, 53.956312200000006], [9.4903265, 53.957109200000005], [9.490532, 53.9577236], [9.4908085, 53.9586509], [9.491191200000001, 53.9601325], [9.4913577, 53.9609285], [9.4915333, 53.961858400000004], [9.4917277, 53.9635121], [9.4918251, 53.9647543], [9.4918524, 53.9668104], [9.491862600000001, 53.967436600000006], [9.4918604, 53.9676599], [9.4918406, 53.9697429], [9.4918388, 53.969940400000006], [9.491817900000001, 53.9721326], [9.4918145, 53.97248870000001], [9.4917639, 53.9778159], [9.4917566, 53.978866000000004], [9.4916961, 53.9797461], [9.4914856, 53.981545600000004], [9.4908611, 53.984678], [9.490098600000001, 53.987068], [9.4898301, 53.987798500000004], [9.489451800000001, 53.9887755], [9.4873908, 53.9931515], [9.487261100000001, 53.9933969], [9.4863085, 53.9950758], [9.485518800000001, 53.9964032], [9.4854388, 53.996542500000004], [9.484358100000001, 53.998220100000005], [9.483363, 53.9996414], [9.4813025, 54.002384600000006], [9.480175200000001, 54.003776], [9.4790776, 54.0050383], [9.4787335, 54.0053885], [9.477605500000001, 54.006612800000006], [9.476008, 54.008259200000005], [9.4753336, 54.008943200000004], [9.473494200000001, 54.0106813], [9.471382700000001, 54.01257450000001], [9.4684071, 54.014966900000005], [9.467901000000001, 54.015356000000004], [9.4668583, 54.01615760000001], [9.4653506, 54.017267000000004], [9.4631848, 54.0188021], [9.4608773, 54.0203015], [9.4590105, 54.0214573], [9.456385800000001, 54.0230316], [9.4532298, 54.0247528], [9.452955000000001, 54.0249011], [9.4523122, 54.025255800000004], [9.4492709, 54.0268388], [9.447608500000001, 54.0276738], [9.444025700000001, 54.0293976], [9.4420546, 54.030332200000004], [9.4370246, 54.032624000000006], [9.4286321, 54.036394400000006], [9.4263562, 54.037367100000004], [9.4239119, 54.0384041], [9.421675, 54.039332900000005], [9.4188025, 54.040500900000005], [9.4156513, 54.041759600000006], [9.4125528, 54.0429656], [9.410830800000001, 54.0436235], [9.4062248, 54.0453595], [9.4035759, 54.046331800000004], [9.399436000000001, 54.047814], [9.397818000000001, 54.048382000000004], [9.3961868, 54.04893980000001], [9.392792700000001, 54.050110200000006], [9.389705000000001, 54.0511368], [9.3866075, 54.052148700000004], [9.383430200000001, 54.0531567], [9.3804759, 54.0540754], [9.379195600000001, 54.054473400000006], [9.377175600000001, 54.055079600000006], [9.3739749, 54.056042100000006], [9.3721037, 54.056589300000006], [9.370379900000001, 54.0570833], [9.3682028, 54.0577072], [9.3667031, 54.058130000000006], [9.3642672, 54.058801800000005], [9.3619752, 54.059422700000006], [9.360963700000001, 54.059690800000006], [9.358466, 54.060352200000004], [9.3548366, 54.0612927], [9.351170100000001, 54.062209900000006], [9.347716100000001, 54.063051800000004], [9.3435354, 54.0640427], [9.3392126, 54.065033500000006], [9.3355339, 54.065848800000005], [9.335269100000001, 54.065904200000006], [9.3306964, 54.0668761], [9.327128100000001, 54.067598600000004], [9.323498800000001, 54.0683196], [9.319114200000001, 54.0691526], [9.3169178, 54.0695637], [9.311183600000001, 54.0705788], [9.3055895, 54.071541700000004], [9.3033949, 54.071893200000005], [9.2961159, 54.073002900000006], [9.2918426, 54.0736573], [9.288931700000001, 54.0741025], [9.2885715, 54.07415760000001], [9.28616, 54.0745324], [9.2847536, 54.074779500000005], [9.283731300000001, 54.0749897], [9.282745700000001, 54.075217200000004], [9.2816582, 54.0755088], [9.2809448, 54.0757095], [9.2802831, 54.075915800000004], [9.2792477, 54.07626260000001], [9.2783041, 54.0766098], [9.2774921, 54.076937], [9.2768283, 54.077222600000006], [9.276179200000001, 54.077527100000005], [9.275495900000001, 54.0778649], [9.2747388, 54.078260400000005], [9.2741517, 54.078596600000004], [9.2735707, 54.0789472], [9.2730177, 54.0792987], [9.272589100000001, 54.079585300000005], [9.272136900000001, 54.079911900000006], [9.2717535, 54.0802014], [9.2713099, 54.0805518], [9.2705278, 54.0812171], [9.269823, 54.081903800000006], [9.2693866, 54.082363], [9.2690418, 54.0827551], [9.268778000000001, 54.083086800000004], [9.2682573, 54.083784900000005], [9.2678422, 54.0844213], [9.267509, 54.084992500000006], [9.267202600000001, 54.085606500000004], [9.266988600000001, 54.086095400000005], [9.266797500000001, 54.0865887], [9.266594300000001, 54.087230500000004], [9.2664367, 54.087866500000004], [9.266330100000001, 54.088467], [9.266256100000001, 54.0890999], [9.2662175, 54.089742900000005], [9.266196, 54.090276200000005], [9.266194, 54.091565200000005], [9.2661935, 54.0942493], [9.2661536, 54.095571400000004], [9.2661219, 54.0961889], [9.266073500000001, 54.09680590000001], [9.2659222, 54.098106300000005], [9.2657544, 54.0992362], [9.265512000000001, 54.100410700000005], [9.2651988, 54.101642500000004], [9.2648978, 54.102649500000005], [9.264592700000001, 54.103593200000006], [9.2639004, 54.105523600000005], [9.2623561, 54.109370500000004], [9.2613163, 54.111937000000005], [9.2606769, 54.113562300000005], [9.259809, 54.1155941], [9.2589659, 54.117755900000006], [9.258440100000001, 54.1190937], [9.257870500000001, 54.120469500000006], [9.254666100000001, 54.1284001], [9.2530234, 54.13245130000001], [9.252677100000001, 54.1332394], [9.2525385, 54.1335678], [9.2520728, 54.134599900000005], [9.2513804, 54.1360254], [9.2510147, 54.13673180000001], [9.2505603, 54.1375358], [9.2497339, 54.138868800000004], [9.248869200000001, 54.140154700000004], [9.2482048, 54.1410769], [9.2471849, 54.1423731], [9.2464563, 54.143266700000005], [9.2456707, 54.144131300000005], [9.2447008, 54.1451622], [9.2436212, 54.1462365], [9.2430606, 54.1467772], [9.242569900000001, 54.14722630000001], [9.2416832, 54.148034900000006], [9.2415296, 54.148171000000005], [9.241261600000001, 54.1483914], [9.239142300000001, 54.1500982], [9.2379671, 54.150981800000004], [9.2373957, 54.151394100000005], [9.2367539, 54.1518445], [9.2356268, 54.1526021], [9.2349469, 54.153038], [9.2343785, 54.15338070000001], [9.2336071, 54.153835900000004], [9.2329433, 54.1542121], [9.232207, 54.1546055], [9.231511000000001, 54.15495610000001], [9.2305387, 54.155438800000006], [9.2300143, 54.155688500000004], [9.2294716, 54.1559339], [9.228928, 54.15617700000001], [9.228376800000001, 54.156413400000005], [9.2274018, 54.1568155], [9.225558900000001, 54.1575184], [9.2233664, 54.158254400000004], [9.2209558, 54.15897270000001], [9.219014000000001, 54.159483400000006], [9.213841200000001, 54.1607915], [9.2113603, 54.1614214], [9.2088631, 54.162008300000004], [9.2069825, 54.1624063], [9.2059978, 54.1625931], [9.2050859, 54.162753], [9.2043242, 54.162879200000006], [9.203079800000001, 54.1630613], [9.201920000000001, 54.163212900000005], [9.201105400000001, 54.163309600000005], [9.1997589, 54.1634426], [9.1983887, 54.163560200000006], [9.1973824, 54.163627700000006], [9.1961977, 54.163692600000005], [9.1954616, 54.163727400000006], [9.1946407, 54.163753500000006], [9.1936769, 54.163777100000004], [9.1918047, 54.163798400000005], [9.181812800000001, 54.1638449], [9.1736273, 54.1638784], [9.1681407, 54.163906000000004], [9.166486500000001, 54.163913], [9.1647089, 54.1639265], [9.163419300000001, 54.1639501], [9.162650900000001, 54.163977100000004], [9.1616222, 54.164015400000004], [9.1607131, 54.1640608], [9.159708700000001, 54.1641296], [9.158792700000001, 54.16420290000001], [9.1577065, 54.1643029], [9.156734, 54.1644049], [9.1558889, 54.164505600000005], [9.154957300000001, 54.164629000000005], [9.1521872, 54.165039400000005], [9.145855300000001, 54.166069300000004], [9.143820100000001, 54.1663682], [9.1427399, 54.1665183], [9.141778, 54.166638600000006], [9.140704900000001, 54.1667665], [9.1397264, 54.1668755], [9.138472, 54.166997800000004], [9.137753100000001, 54.1670643], [9.1358583, 54.1672184], [9.134963800000001, 54.1672863], [9.134006000000001, 54.167346200000004], [9.132067900000001, 54.1674511], [9.1301421, 54.16752880000001], [9.128306100000001, 54.1675721], [9.126541300000001, 54.167589500000005], [9.1247147, 54.1675838], [9.1229333, 54.1675538], [9.1219943, 54.167527500000006], [9.1213233, 54.167504300000004], [9.119730500000001, 54.167439300000005], [9.1180578, 54.16736220000001], [9.1129516, 54.1670929], [9.110873900000001, 54.1669939], [9.1097725, 54.1669549], [9.1086465, 54.166932200000005], [9.107641300000001, 54.166925400000004], [9.1072818, 54.166928000000006], [9.1069115, 54.166925500000005], [9.1052291, 54.166956600000006], [9.1039437, 54.16700470000001], [9.103668800000001, 54.167019800000006], [9.1019179, 54.1671241], [9.1002059, 54.1672646], [9.099372, 54.1673478], [9.0987591, 54.1674165], [9.0980174, 54.1674918], [9.0966159, 54.1676793], [9.0949912, 54.1679127], [9.0930716, 54.1681977], [9.0925293, 54.1682786], [9.091795000000001, 54.1683882], [9.0908906, 54.1685231], [9.0904082, 54.168595100000005], [9.0892133, 54.168773400000006], [9.087535, 54.169025000000005], [9.0862107, 54.169217], [9.0859684, 54.1692534], [9.0833703, 54.1696456], [9.081842100000001, 54.1698723], [9.0794951, 54.170228400000006], [9.0786937, 54.170356000000005], [9.0773151, 54.170592500000005], [9.0755473, 54.170937300000006], [9.074764400000001, 54.1711022], [9.0736913, 54.1713499], [9.0718473, 54.171812], [9.0701861, 54.172280900000004], [9.0684691, 54.17281070000001], [9.066580100000001, 54.173464800000005], [9.064749500000001, 54.1741712], [9.0637726, 54.1745765], [9.063131, 54.17485430000001], [9.0618198, 54.1754642], [9.0610415, 54.175844700000006], [9.060352, 54.176198500000005], [9.0589341, 54.1769675], [9.057571900000001, 54.1777668], [9.056825, 54.178237700000004], [9.0562298, 54.1786291], [9.0556175, 54.1790529], [9.054987, 54.1795005], [9.054527700000001, 54.1798438], [9.0537528, 54.18045], [9.052601300000001, 54.1814259], [9.0517821, 54.182165600000005], [9.050895, 54.183036400000006], [9.0499779, 54.1840278], [9.049455400000001, 54.18465320000001], [9.0489608, 54.1852827], [9.048630600000001, 54.185703000000004], [9.047900700000001, 54.186738600000005], [9.047270300000001, 54.18777660000001], [9.046536900000001, 54.1891673], [9.046259300000001, 54.1898143], [9.0459575, 54.1905833], [9.0456894, 54.1913417], [9.045414300000001, 54.1923206], [9.0451805, 54.193314300000004], [9.045061800000001, 54.19404230000001], [9.044970600000001, 54.194751700000005], [9.044896000000001, 54.1955393], [9.044860400000001, 54.196437200000005], [9.044875900000001, 54.196970500000006], [9.0449445, 54.1974992], [9.0449734, 54.1978419], [9.045031400000001, 54.1983503], [9.0450953, 54.198824200000004], [9.045301400000001, 54.199885200000004], [9.045520100000001, 54.2008214], [9.045924300000001, 54.202014500000004], [9.046343700000001, 54.203064700000006], [9.047215300000001, 54.205200700000006], [9.0475224, 54.2062432], [9.047757, 54.207337900000006], [9.0478289, 54.20818310000001], [9.0477808, 54.2093531], [9.0476393, 54.2102239], [9.0472657, 54.2113546], [9.0467838, 54.2124752], [9.045253, 54.215991900000006], [9.0437464, 54.219441], [9.0435736, 54.2198329], [9.0421723, 54.223114100000004], [9.042005300000001, 54.2234715], [9.0394597, 54.229170100000005], [9.037008, 54.234790200000006], [9.036564700000001, 54.2358138], [9.036321800000001, 54.2364468], [9.0361402, 54.23716640000001], [9.0360613, 54.237728700000005], [9.0360935, 54.2385097], [9.0361471, 54.239049], [9.0362866, 54.2395568], [9.0365012, 54.2401525], [9.036674900000001, 54.2405788], [9.0368423, 54.240916000000006], [9.037063700000001, 54.2412682], [9.0378553, 54.242375200000005], [9.0381374, 54.242768700000006], [9.0385826, 54.243425200000004], [9.0388508, 54.243870300000005], [9.0391442, 54.24450220000001], [9.039305200000001, 54.245185600000006], [9.039398, 54.245544100000004], [9.0394409, 54.246089500000004], [9.039451600000001, 54.2464657], [9.039398, 54.2470487], [9.039301400000001, 54.247663], [9.039194100000001, 54.2480266], [9.037038500000001, 54.254724700000004], [9.0366295, 54.2559076], [9.0363617, 54.256745300000006], [9.0359111, 54.25825570000001], [9.035557, 54.25923340000001], [9.0351923, 54.259947800000006], [9.034838200000001, 54.260436600000006], [9.0343447, 54.2610194], [9.033529300000001, 54.2618215], [9.0331493, 54.262145700000005], [9.0329554, 54.262298300000005], [9.0327277, 54.262451500000005], [9.0323037, 54.2627412], [9.0312634, 54.263350800000005], [9.0120105, 54.2739911], [9.009982200000001, 54.2751157], [9.0083117, 54.276019500000004], [9.0075135, 54.276453100000005], [9.0069006, 54.2767714], [9.0043571, 54.2782174], [9.0017642, 54.2796285], [8.9965765, 54.2825149], [8.9957926, 54.2829527], [8.988614, 54.286961500000004], [8.986041100000001, 54.2884265], [8.9835302, 54.2898532], [8.9821199, 54.2906847], [8.9816023, 54.290987], [8.979113100000001, 54.292440400000004], [8.978876600000001, 54.292578500000005], [8.976489, 54.293969000000004], [8.9726602, 54.2962683], [8.9700784, 54.2978309], [8.9688082, 54.2986719], [8.9681777, 54.2991108], [8.967557000000001, 54.2995583], [8.966417100000001, 54.300424400000004], [8.9650925, 54.3014634], [8.963846700000001, 54.30256180000001], [8.962656200000001, 54.30368], [8.9619996, 54.3043447], [8.9613893, 54.304996200000005], [8.960280500000001, 54.306287700000006], [8.960036200000001, 54.3065836], [8.9596652, 54.3071088], [8.959346700000001, 54.307575500000006], [8.9589985, 54.308110000000006], [8.9589163, 54.308238700000004], [8.9585884, 54.3088131], [8.9584803, 54.3090253], [8.9583338, 54.309341700000004], [8.9580483, 54.30996570000001], [8.957998, 54.310089700000006], [8.9577223, 54.3108251], [8.9575388, 54.3113985], [8.9573818, 54.3120227], [8.9572249, 54.3126638], [8.956724000000001, 54.3146854], [8.9564951, 54.3156674], [8.9564267, 54.3160729], [8.9563213, 54.316739000000005], [8.955914100000001, 54.3184872], [8.955695, 54.319455600000005], [8.9555209, 54.320239], [8.9554582, 54.3205207], [8.955397900000001, 54.3207907], [8.9553355, 54.3210696], [8.9552074, 54.321642700000005], [8.9551473, 54.321911400000005], [8.9549795, 54.3226622], [8.9548108, 54.323416800000004], [8.9546527, 54.324123900000004], [8.9544124, 54.325277500000006], [8.9543978, 54.325393500000004], [8.954196000000001, 54.3268135], [8.9541351, 54.32747740000001], [8.9540801, 54.328834300000004], [8.9541111, 54.329875900000005], [8.954181, 54.330440100000004], [8.9543323, 54.3309488], [8.9544884, 54.3312777], [8.9548488, 54.331823500000006], [8.955419800000001, 54.3324756], [8.9556587, 54.3326866], [8.9557982, 54.332818200000006], [8.957872, 54.3346833], [8.9604607, 54.3369829], [8.9608127, 54.33728970000001], [8.961147200000001, 54.3375932], [8.964510200000001, 54.3405597], [8.9647418, 54.340765100000006], [8.965166400000001, 54.341138], [8.9690715, 54.344554], [8.9698698, 54.3452944], [8.9703718, 54.34592670000001], [8.9706407, 54.346408200000006], [8.970809800000001, 54.346848900000005], [8.9709078, 54.3472786], [8.9709344, 54.347955600000006], [8.9706471, 54.351975100000004], [8.9705645, 54.353312900000006], [8.9706233, 54.353795100000006], [8.9707936, 54.354201], [8.9709906, 54.3545474], [8.9713188, 54.35511030000001], [8.9715173, 54.3554132], [8.971628500000001, 54.355597700000004], [8.971703, 54.3557319], [8.9718616, 54.356008700000004], [8.9719081, 54.356100100000006], [8.9727241, 54.357494300000006], [8.9751676, 54.3616584], [8.977989, 54.3664563], [8.9782904, 54.366987400000006], [8.9785932, 54.3675063], [8.9789302, 54.368079], [8.9791447, 54.3684048], [8.979310700000001, 54.3685896], [8.9794684, 54.36873550000001], [8.9797282, 54.3689181], [8.9799915, 54.3690689], [8.980365200000001, 54.3692414], [8.9823979, 54.370071100000004], [8.9934273, 54.3745333], [8.9944597, 54.3749509], [8.9950752, 54.375202400000006], [8.997053600000001, 54.376006100000005], [8.9981024, 54.376515700000006], [8.9988711, 54.377019100000005], [8.9995835, 54.377620900000004], [8.9999987, 54.378079500000005], [9.0002818, 54.378452], [9.0004147, 54.378644800000004], [9.000698400000001, 54.379111200000004], [9.0036663, 54.3844105], [9.0037828, 54.384616900000005], [9.0038627, 54.3847584], [9.0040198, 54.3850367], [9.0043196, 54.385563100000006], [9.005800500000001, 54.3881888], [9.006295300000001, 54.388816500000004], [9.0064437, 54.388975900000005], [9.0067707, 54.389283600000006], [9.006995, 54.3894693], [9.0072427, 54.3896663], [9.0076084, 54.3899206], [9.007781900000001, 54.3900343], [9.0080606, 54.3902], [9.0082979, 54.390327000000006], [9.0087787, 54.3905553], [9.009181700000001, 54.390732400000005], [9.009478900000001, 54.3908465], [9.009898900000001, 54.3909895], [9.0102916, 54.391114300000005], [9.0106652, 54.39122020000001], [9.0109656, 54.391302200000005], [9.0115172, 54.3914277], [9.0117674, 54.391483300000004], [9.0198228, 54.3932705], [9.0211012, 54.393534], [9.0233374, 54.394056600000006], [9.0242453, 54.3943887], [9.0245499, 54.3945092], [9.0247277, 54.3945981], [9.025120300000001, 54.394780000000004], [9.025605800000001, 54.395076100000004], [9.025962100000001, 54.3953063], [9.0263965, 54.395613000000004], [9.0266017, 54.3957975], [9.027226500000001, 54.396481400000006], [9.027388100000001, 54.3966763], [9.028047500000001, 54.397654100000004], [9.0286494, 54.3986109], [9.029684600000001, 54.4002379], [9.0303877, 54.401278700000006], [9.0304643, 54.401393600000006], [9.030595700000001, 54.4015446], [9.031059500000001, 54.402069600000004], [9.031384000000001, 54.4023953], [9.033373300000001, 54.4042103], [9.035225500000001, 54.405901300000004], [9.0405992, 54.4107562], [9.0424396, 54.412416900000004], [9.0431861, 54.4131219], [9.0439003, 54.413760800000006], [9.0451396, 54.4149061], [9.048921700000001, 54.4183272], [9.049962500000001, 54.419516], [9.050442400000001, 54.420084200000005], [9.0508752, 54.420639200000004], [9.0541225, 54.424871100000004], [9.054741700000001, 54.425732700000005], [9.0549622, 54.426146800000005], [9.0551119, 54.4265684], [9.055186500000001, 54.426818000000004], [9.0552765, 54.427252300000006], [9.0552968, 54.4276143], [9.0552635, 54.428050000000006], [9.0551759, 54.428440200000004], [9.0550315, 54.428836800000006], [9.0548731, 54.4291758], [9.0546551, 54.4295338], [9.0544448, 54.429820500000005], [9.054229000000001, 54.430076500000006], [9.0539153, 54.430397500000005], [9.0536869, 54.4306059], [9.053416, 54.430815900000006], [9.053074500000001, 54.43106280000001], [9.052546600000001, 54.431396500000005], [9.0516685, 54.4319063], [9.050181100000001, 54.432756600000005], [9.0472552, 54.434468800000005], [9.0456365, 54.435417900000004], [9.045053300000001, 54.435855000000004], [9.0446466, 54.436307000000006], [9.044446200000001, 54.436607800000004], [9.044257400000001, 54.4370296], [9.044170000000001, 54.437702300000005], [9.044242500000001, 54.4382364], [9.0444016, 54.438776100000005], [9.0452169, 54.4409367], [9.045946800000001, 54.4430507], [9.047393000000001, 54.4472631], [9.0475685, 54.4477319], [9.0476694, 54.44820120000001], [9.047681200000001, 54.448424200000005], [9.0476942, 54.448584800000006], [9.04765, 54.448950100000005], [9.0475493, 54.449312600000006], [9.047201000000001, 54.450226300000004], [9.0468592, 54.451051500000005], [9.046729800000001, 54.451413800000005], [9.0467113, 54.451490400000004], [9.046641300000001, 54.451768300000005], [9.0465627, 54.452201900000006], [9.0465474, 54.452501000000005], [9.046592500000001, 54.4528211], [9.0466578, 54.4530636], [9.0467767, 54.4533968], [9.0469542, 54.45371900000001], [9.0471421, 54.4539988], [9.047453, 54.45436410000001], [9.0477336, 54.4546305], [9.0480053, 54.454851700000006], [9.048412200000001, 54.4551293], [9.0488607, 54.455392], [9.0496686, 54.4557572], [9.053831500000001, 54.4574489], [9.058803000000001, 54.459470800000005], [9.063660500000001, 54.46145490000001], [9.0661997, 54.46254570000001], [9.067088400000001, 54.4629417], [9.0678781, 54.463315], [9.0690006, 54.463867500000006], [9.069989900000001, 54.4643828], [9.070745500000001, 54.464802600000006], [9.071522, 54.465253600000004], [9.072229400000001, 54.46567460000001], [9.073173200000001, 54.4662889], [9.073467500000001, 54.466475700000004], [9.0747517, 54.467390800000004], [9.0752281, 54.467729000000006], [9.0759968, 54.468349800000006], [9.0767457, 54.4689734], [9.0770312, 54.4692255], [9.0778827, 54.4699779], [9.0799634, 54.471911500000004], [9.0806331, 54.472562200000006], [9.081383500000001, 54.473277100000004], [9.082595900000001, 54.4745105], [9.0830672, 54.474972300000005], [9.083474, 54.4753709], [9.084164000000001, 54.476047], [9.0844368, 54.4763202], [9.085509400000001, 54.477408100000005], [9.086984300000001, 54.478945100000004], [9.0873433, 54.4793394], [9.087753900000001, 54.4797791], [9.088150500000001, 54.4802231], [9.088935000000001, 54.481145500000004], [9.0892011, 54.481474600000006], [9.089609300000001, 54.482000400000004], [9.0902159, 54.4828215], [9.090679600000001, 54.4834674], [9.091133000000001, 54.4842121], [9.0915406, 54.484931100000004], [9.0917168, 54.485241800000004], [9.0918744, 54.485553700000004], [9.092003100000001, 54.4858477], [9.0922488, 54.4864843], [9.0924455, 54.487079], [9.0926211, 54.487730600000006], [9.092699300000001, 54.488139700000005], [9.092828, 54.488829300000006], [9.0928924, 54.489436600000005], [9.092909200000001, 54.4897459], [9.0929176, 54.49004540000001], [9.0929199, 54.490360100000004], [9.092913900000001, 54.4906748], [9.0928652, 54.4913017], [9.0927938, 54.4918564], [9.0926936, 54.4924162], [9.0922701, 54.49381150000001], [9.0920957, 54.494284900000004], [9.0918404, 54.494947800000006], [9.0915959, 54.495459700000005], [9.091203700000001, 54.496120700000006], [9.090932800000001, 54.496532], [9.090436500000001, 54.497285500000004], [9.0903623, 54.4973876], [9.0897568, 54.4981694], [9.089007200000001, 54.4990266], [9.088468, 54.4996367], [9.0872785, 54.5008325], [9.0856563, 54.5023476]]"
                drawLineWithStringOfCoordinates(path)
                downloadBar.visibility = View.INVISIBLE
                sendDownloadRequestButton.text = "download map"
            }

        }



    }


    /**
     * send request to backend with 4 parameters, which specify the area of the graph to be downloaded
     */
    private fun sendSubgraphGetRequest(minLat:Double, maxLat:Double, minLong:Double, maxLong:Double) {
        var graphFile: String = ""
        //asychro:
        val client = OkHttpClient()
            .newBuilder()
            .readTimeout(10, TimeUnit.MINUTES)
            .writeTimeout(10, TimeUnit.MINUTES)
            .connectTimeout(10, TimeUnit.MINUTES).build()


        client.run {
            val request = Request.Builder()
                .url("http://192.168.0.10:8081/subgraph?minLat=$minLat&maxLat=$maxLat&minLong=$minLong&maxLong=$maxLong")
                .build()

            client.newCall(request).enqueue(object : Callback {
                override fun onFailure(call: Call, e: IOException) {
                    e.printStackTrace()
                }

                override fun onResponse(call: Call, response: Response) {
                    response.use {
                        val downloadBar: ProgressBar = findViewById(R.id.downloadProgressBar)
//                        downloadBar.visibility = View.INVISIBLE
                        if (!response.isSuccessful) throw IOException("Unexpected code $response")

                        graphFile = response.body!!.string()

                        //print downloaded data, for test:
                        //println(graphFile)
                        println("graphfile downloaded.")
                        //create graph data structure and compute the path using downloaded data
                        subGraph = Graph(graphFile)

                        subgraphDataDownloaded = true
                        println("node number: "+subGraph.nodeNr)
                        println("edge number: "+subGraph.edgeNr)


                    }
                }
            })
        }
    }




    /**
     * display the path on the map, given a string of path in lat, long
     * string format:"[[firstLat,_firstLong],_[secondLat,_secondLong],_...,_[lastLat,_lastLong]]" space represented undersocre because easy of read.
     */
    private fun drawLineWithStringOfCoordinates(stringPath: String){
        //get rid of the first and last 2 characters
        val newStringPath = stringPath.drop(2).dropLast(2)
        //now the string looks like this:"firstLat,_firstLong],_[secondLat,_secondLong],_...,_[lastLat,_lastLong"
        val path = Polyline()
        //first split:
        val latLongPath: List<String> = newStringPath.split("], [")
        //now the string element in the list looks like this: firstLat,_firstLong
        val pointList:MutableList<GeoPoint> = mutableListOf()
        for (coordinates in latLongPath){
            val latLong:List<String> = coordinates.split(", ")
            //Lat and Long are given to GeoPoint constructor in reverse order because GeoPoint expects first argument to be longitude and second argument to be latitude
            pointList.add(GeoPoint(latLong[1].toDouble(),latLong[0].toDouble()))
        }
        path.setPoints(pointList)
        map.overlays.add(path)
        map.invalidate()

    }







    override fun onResume() {
        super.onResume();
        //this will refresh the osmdroid configuration on resuming.
        //if you make changes to the configuration, use
        //SharedPreferences prefs = PreferenceManager.getDefaultSharedPreferences(this);
        //Configuration.getInstance().load(this, PreferenceManager.getDefaultSharedPreferences(this));
        map.onResume(); //needed for compass, my location overlays, v6.0.0 and up
    }

    override fun onPause() {
        super.onPause();
        //this will refresh the osmdroid configuration on resuming.
        //if you make changes to the configuration, use
        //SharedPreferences prefs = PreferenceManager.getDefaultSharedPreferences(this);
        //Configuration.getInstance().save(this, prefs);
        map.onPause();  //needed for compass, my location overlays, v6.0.0 and up
    }

}